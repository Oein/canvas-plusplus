var F=Object.defineProperty;var Z=(d,t,s)=>t in d?F(d,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):d[t]=s;var y=(d,t,s)=>Z(d,typeof t!="symbol"?t+"":t,s);import{a as C,m as h,i as g,g as u,s as L}from"./index-iEba6fp4.js";class P{constructor(t,s,e){y(this,"modal");y(this,"xInput");y(this,"yInput");y(this,"keypad");y(this,"confirmButton");y(this,"cancelButton");y(this,"keypadVisible",!1);y(this,"activeInput");this.onDone=t,this.modal=document.createElement("div"),this.modal.style.position="fixed",this.modal.style.top="0",this.modal.style.left="0",this.modal.style.width="100%",this.modal.style.height="100%",this.modal.style.backgroundColor="rgba(0, 0, 0, 0.5)",this.modal.style.display="flex",this.modal.style.justifyContent="center",this.modal.style.alignItems="center",this.modal.style.zIndex="1000000000";const l=document.createElement("div");if(l.style.backgroundColor="#fff",l.style.padding="20px",l.style.borderRadius="8px",l.style.boxShadow="0 4px 8px rgba(0, 0, 0, 0.1)",l.style.maxWidth="400px",l.style.width="300px",l.style.boxSizing="border-box",l.style.position="relative",s){const o=document.createElement("h2");o.textContent=s,o.style.marginBottom=".5rem",o.style.marginTop="0",o.style.padding="0",o.style.textAlign="center",l.appendChild(o)}if(e){const o=document.createElement("p");o.innerHTML=e,o.style.marginBottom="10px",o.style.marginTop="0",o.style.padding="0",o.style.fontSize="14px",o.style.color="#666",o.style.textAlign="center",l.appendChild(o)}const c=document.createElement("div");c.style.display="flex",c.style.alignItems="center",c.style.marginBottom="15px";const x=document.createElement("label");x.textContent="X:",x.style.marginRight="10px",this.xInput=document.createElement("input"),this.xInput.type="text",this.xInput.style.flex="1",this.xInput.style.padding="10px",this.xInput.style.border="1px solid #ccc",this.xInput.style.borderRadius="4px",this.xInput.style.boxSizing="border-box";const n=document.createElement("button");n.textContent="⌨️",n.style.marginLeft="10px",n.style.padding="5px",n.style.border="1px solid #ccc",n.style.borderRadius="4px",n.style.cursor="pointer",n.style.height="40px",n.style.width="40px",n.style.textAlign="center",n.addEventListener("click",()=>this.toggleKeypad(this.xInput)),c.appendChild(x),c.appendChild(this.xInput),c.appendChild(n);const i=document.createElement("div");i.style.display="flex",i.style.alignItems="center",i.style.marginBottom="15px";const a=document.createElement("label");a.textContent="Y:",a.style.marginRight="10px",this.yInput=document.createElement("input"),this.yInput.type="text",this.yInput.style.flex="1",this.yInput.style.padding="10px",this.yInput.style.border="1px solid #ccc",this.yInput.style.borderRadius="4px",this.yInput.style.boxSizing="border-box";const r=document.createElement("button");r.textContent="⌨️",r.style.marginLeft="10px",r.style.padding="5px",r.style.border="1px solid #ccc",r.style.borderRadius="4px",r.style.cursor="pointer",r.style.height="40px",r.style.width="40px",r.style.textAlign="center",r.addEventListener("click",()=>this.toggleKeypad(this.yInput)),i.appendChild(a),i.appendChild(this.yInput),i.appendChild(r),this.confirmButton=document.createElement("button"),this.confirmButton.textContent="Confirm",this.confirmButton.style.marginRight="10px",this.confirmButton.style.padding="10px 20px",this.confirmButton.style.border="none",this.confirmButton.style.backgroundColor="#007bff",this.confirmButton.style.color="#fff",this.confirmButton.style.borderRadius="4px",this.confirmButton.style.cursor="pointer",this.cancelButton=document.createElement("button"),this.cancelButton.textContent="Cancel",this.cancelButton.style.padding="10px 20px",this.cancelButton.style.border="none",this.cancelButton.style.backgroundColor="#ccc",this.cancelButton.style.color="#000",this.cancelButton.style.borderRadius="4px",this.cancelButton.style.cursor="pointer",this.keypad=document.createElement("div"),this.keypad.style.position="absolute",this.keypad.style.right="-150px",this.keypad.style.top="20px",this.keypad.style.width="150px",this.keypad.style.backgroundColor="#fff",this.keypad.style.border="1px solid #ccc",this.keypad.style.borderRadius="8px",this.keypad.style.boxShadow="0 4px 8px rgba(0, 0, 0, 0.1)",this.keypad.style.display="none",this.keypad.style.gridTemplateColumns="repeat(3, 1fr)",this.keypad.style.gap="10px",this.keypad.style.padding="10px",this.keypad.style.boxSizing="border-box",this.keypad.style.gridAutoRows="40px",["1","2","3","4","5","6","7","8","9","-","0","←"].forEach(o=>{const p=document.createElement("button");p.textContent=o,p.style.padding="10px",p.style.border="1px solid #ccc",p.style.borderRadius="4px",p.style.cursor="pointer",p.addEventListener("click",()=>{o==="←"?this.activeInput.value=this.activeInput.value.slice(0,-1):this.activeInput.value+=o}),this.keypad.appendChild(p)}),l.appendChild(c),l.appendChild(i),l.appendChild(this.confirmButton),l.appendChild(this.cancelButton),l.appendChild(this.keypad),this.modal.appendChild(l),this.confirmButton.addEventListener("click",()=>this.onConfirm()),this.cancelButton.addEventListener("click",()=>this.onCancel())}toggleKeypad(t){this.activeInput=t,this.keypadVisible=!this.keypadVisible,this.keypad.style.display=this.keypadVisible?"grid":"none"}onConfirm(){const t=parseFloat(this.xInput.value),s=parseFloat(this.yInput.value);if(isNaN(t)||isNaN(s)){alert("Please enter valid numbers for both coordinates.");return}this.onDone({x:t,y:s}),this.close()}onCancel(){this.onDone(null),this.close()}close(){this.modal.parentElement&&this.modal.parentElement.removeChild(this.modal)}open(){document.body.appendChild(this.modal),this.xInput.focus()}}function w(){const d=document.createElement("canvas"),t=d.getContext("2d");if(!t)throw new Error("Failed to create canvas context");d.width=window.innerWidth,d.height=window.innerHeight;const s=()=>{d.width=window.innerWidth,d.height=window.innerHeight};return window.addEventListener("resize",s),{canvas:d,ctx:t,destroy:()=>window.removeEventListener("resize",s)}}let D=1;function T(d=1){return D+=3,D%=360,`hsla(${D}, 100%, 50%, ${d})`}function I(d){if("targetTouches"in d){if(d.targetTouches.item(0))d.preventDefault();else return{x:-1,y:-1};return{x:d.targetTouches.item(0).pageX,y:d.targetTouches.item(0).pageY}}else return{x:d.pageX||d.offsetX||d.clientX,y:d.pageY||d.offsetY||d.clientY}}function f(d,t){const s=l=>{t(I(l),l)},e=l=>{l.preventDefault()};return d.addEventListener("pointermove",s),d.addEventListener("touchmove",e),()=>{d.removeEventListener("pointermove",s),d.removeEventListener("touchmove",e)}}function v(d,t){const s=l=>{t(I(l),l)},e=l=>{l.preventDefault()};return d.addEventListener("pointerdown",s),d.addEventListener("touchstart",e),()=>{d.removeEventListener("pointerdown",s),d.removeEventListener("touchstart",e)}}function E(d,t){const s=l=>{t(I(l),l)},e=l=>{l.preventDefault()};return d.addEventListener("pointerup",s),d.addEventListener("touchend",e),()=>{d.removeEventListener("pointerup",s),d.removeEventListener("touchend",e)}}class X{constructor(){y(this,"toolsArea");y(this,"bboxElem");y(this,"bboxScaleElem");y(this,"bboxRotateElem");y(this,"selectedObjects",[]);y(this,"instCanvas");y(this,"state","IDLE");y(this,"bboxListenDestroiers",[]);y(this,"nextBBoxColor",null);this.toolsArea=document.getElementById("toolsArea")}createBBox(){this.bboxElem=document.createElement("div"),this.bboxElem.style.position="fixed",this.bboxElem.style.border="1px dashed "+T(1),this.bboxElem.style.background=this.nextBBoxColor||T(.3),this.bboxElem.style.zIndex="15",this.nextBBoxColor=null;const t=this.selectedObjects.map(x=>h.focused.cachecdPolygon[x]);let s=1/0,e=1/0,l=-1/0,c=-1/0;for(const x of t)for(const n of x)s=Math.min(s,n.x),e=Math.min(e,n.y),l=Math.max(l,n.x),c=Math.max(c,n.y);this.bboxElem.style.left=s+"px",this.bboxElem.style.top=e+"px",this.bboxElem.style.width=l-s+"px",this.bboxElem.style.height=c-e+"px",this.bboxElem.style.cursor="move",this.toolsArea.appendChild(this.bboxElem)}listenBBox(){let t={x:0,y:0};const s=v(this.bboxElem,(c,x)=>{this.state==="SELECTED"&&(x.stopPropagation(),x.preventDefault(),this.state="MOVING",t=c,this.instCanvas.style.cursor="move")}),e=f(this.toolsArea,(c,x)=>{if(this.state!=="MOVING")return;x.stopPropagation(),x.preventDefault();const n=c.x-t.x,i=c.y-t.y;t=c;for(const o of this.selectedObjects)h.focused.transform(o,n,i);h.focused.requestRender();const a=parseFloat(this.bboxElem.style.left),r=parseFloat(this.bboxElem.style.top);this.bboxElem.style.left=a+n+"px",this.bboxElem.style.top=r+i+"px"}),l=E(this.toolsArea,(c,x)=>{if(this.state==="MOVING"){x.stopPropagation(),x.preventDefault(),this.state="SELECTED";for(const n of this.selectedObjects)h.focused.cachePolygon(n);this.instCanvas.style.cursor="crosshair",h.focused.saveAsHistory()}});this.bboxListenDestroiers.push(s),this.bboxListenDestroiers.push(e),this.bboxListenDestroiers.push(l)}destroyBBox(){this.bboxElem&&this.bboxElem.remove();for(const t of this.bboxListenDestroiers)t();this.bboxListenDestroiers=[]}createBBoxScale(){this.bboxScaleElem=document.createElement("div"),this.bboxScaleElem.style.position="absolute",this.bboxScaleElem.style.zIndex="15",this.bboxScaleElem.style.width="10px",this.bboxScaleElem.style.height="10px",this.bboxScaleElem.style.background="#fff",this.bboxScaleElem.style.border="1px solid #000",this.bboxScaleElem.style.cursor="nwse-resize",this.bboxScaleElem.style.right="-5px",this.bboxScaleElem.style.bottom="-5px",this.bboxElem.appendChild(this.bboxScaleElem)}listenBBoxScale(){let t={x:0,y:0},s={x:0,y:0},e=0,l=0,c=0,x=0;const n=v(this.bboxScaleElem,(r,o)=>{this.state==="SELECTED"&&(o.stopPropagation(),o.preventDefault(),this.state="SCALE",t=r,s={...r},c=parseFloat(this.bboxElem.style.width),x=parseFloat(this.bboxElem.style.height),e=c+0,l=x+0,this.instCanvas.style.cursor="nwse-resize")}),i=f(this.toolsArea,(r,o)=>{if(this.state!=="SCALE")return;o.stopPropagation(),o.preventDefault();let p=r.x-t.x,m=r.y-t.y,b=c+p,B=x+m,A=b/c,S=B/x;if(g()){let R=r.x-s.x,O=r.y-s.y,H=e+R,_=l+O,N=H/e,q=_/l,M=Math.min(N,q);b=e*M,B=l*M,A=b/c,S=B/x}c=b,x=B,this.bboxElem.style.width=b+"px",this.bboxElem.style.height=B+"px",t=r;for(const R of this.selectedObjects)h.focused.scaleAboutRect(R,{x:parseFloat(this.bboxElem.style.left),y:parseFloat(this.bboxElem.style.top),width:c,height:x},A,S);h.focused.requestRender()}),a=E(this.toolsArea,(r,o)=>{if(this.state==="SCALE"){o.stopPropagation(),o.preventDefault(),this.state="SELECTED";for(const p of this.selectedObjects)h.focused.cachePolygon(p);this.instCanvas.style.cursor="crosshair",h.focused.saveAsHistory()}});this.bboxListenDestroiers.push(n),this.bboxListenDestroiers.push(i),this.bboxListenDestroiers.push(a)}setupBBoxToolButton(t,s){switch(s.style.position="absolute",s.style.width="20px",s.style.height="20px",s.style.backgroundColor="white",s.style.color="black",s.style.textAlign="center",s.style.lineHeight="20px",s.style.cursor="pointer",s.style.border="1px solid black",s.style.display="flex",s.style.justifyContent="center",s.style.alignItems="center",s.style.zIndex="10000000",s.style.pointerEvents="all",t){case"REMOVE":s.style.left="-30px",s.style.top="0px";break;case"TRANSFORM":s.style.left="-30px",s.style.top="20px";break;case"FLIPX":s.style.left="-30px",s.style.top="40px";break;case"FLIPY":s.style.left="-30px",s.style.top="60px";break;case"COPY":s.style.right="-30px",s.style.top="0px";break}}setupBBoxButtonEventHandler(t,s){t.addEventListener("pointerup",e=>{e.preventDefault(),setTimeout(()=>s(),3)})}setupBBoxRemoveButton(){const t=document.createElement("div");return this.setupBBoxToolButton("REMOVE",t),this.setupBBoxButtonEventHandler(t,()=>{for(let s=0;s<this.selectedObjects.length;s++)h.focused.removeElement(this.selectedObjects[s]);h.focused.requestRender(),h.focused.saveAsHistory(),this.disselect()}),t.innerHTML='<svg style="width: 20px; height: 20px;"  xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#000"><path d="M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160 0h80v-360h-80v360ZM280-720v520-520Z"/></svg>',t}setupBBoxTransformButton(){const t=document.createElement("div");this.setupBBoxToolButton("TRANSFORM",t);const s=this.handleSelect.bind(this);return this.setupBBoxButtonEventHandler(t,()=>{const e=[...this.selectedObjects];new P(c=>{if(c!==null){for(let x=0;x<this.selectedObjects.length;x++)h.focused.transform(this.selectedObjects[x],c.x,c.y),h.focused.cachePolygon(this.selectedObjects[x]);h.focused.requestRender(),h.focused.saveAsHistory(),setTimeout(()=>{s(e)},3)}},"이동","상대적 좌표가 필요합니다").open()}),t.innerHTML='<svg style="width: 20px; height: 20px;" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#000"><path d="M440-40v-167l-44 43-56-56 140-140 140 140-56 56-44-43v167h-80ZM220-340l-56-56 43-44H40v-80h167l-43-44 56-56 140 140-140 140Zm520 0L600-480l140-140 56 56-43 44h167v80H753l43 44-56 56Zm-260-80q-25 0-42.5-17.5T420-480q0-25 17.5-42.5T480-540q25 0 42.5 17.5T540-480q0 25-17.5 42.5T480-420Zm0-180L340-740l56-56 44 43v-167h80v167l44-43 56 56-140 140Z"/></svg>',t}setupBBoxFlipXButton(){const t=document.createElement("div");return this.setupBBoxToolButton("FLIPX",t),this.setupBBoxButtonEventHandler(t,()=>{const s=parseFloat(this.bboxElem.style.left),e=parseFloat(this.bboxElem.style.width),l=s+e/2;for(const c of this.selectedObjects)h.focused.flipX(c,l);h.focused.requestRender(),h.focused.saveAsHistory()}),t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentcolor"><path d="M360-120H200q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h160v80H200v560h160v80Zm80 80v-880h80v880h-80Zm160-80v-80h80v80h-80Zm0-640v-80h80v80h-80Zm160 640v-80h80q0 33-23.5 56.5T760-120Zm0-160v-80h80v80h-80Zm0-160v-80h80v80h-80Zm0-160v-80h80v80h-80Zm0-160v-80q33 0 56.5 23.5T840-760h-80Z"/></svg>',t}setupBBoxFlipYButton(){const t=document.createElement("div");return this.setupBBoxToolButton("FLIPY",t),this.setupBBoxButtonEventHandler(t,()=>{const s=parseFloat(this.bboxElem.style.top),e=parseFloat(this.bboxElem.style.height),l=s+e/2;for(const c of this.selectedObjects)h.focused.flipY(c,l);h.focused.requestRender(),h.focused.saveAsHistory()}),t.innerHTML='<svg style="rotate: 90deg;" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentcolor"><path d="M360-120H200q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h160v80H200v560h160v80Zm80 80v-880h80v880h-80Zm160-80v-80h80v80h-80Zm0-640v-80h80v80h-80Zm160 640v-80h80q0 33-23.5 56.5T760-120Zm0-160v-80h80v80h-80Zm0-160v-80h80v80h-80Zm0-160v-80h80v80h-80Zm0-160v-80q33 0 56.5 23.5T840-760h-80Z"/></svg>',t}setupBBoxCopyButton(){const t=document.createElement("div");return this.setupBBoxToolButton("COPY",t),this.setupBBoxButtonEventHandler(t,()=>{const s=[];for(let e=0;e<this.selectedObjects.length;e++){const l=h.focused.cloneObject(this.selectedObjects[e]);s.push(l)}h.focused.requestRender(),this.disselect(),setTimeout(()=>{this.nextBBoxColor="#575B977F",this.handleSelect(s)},3)}),t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentcolor"><path d="M360-240q-33 0-56.5-23.5T280-320v-480q0-33 23.5-56.5T360-880h360q33 0 56.5 23.5T800-800v480q0 33-23.5 56.5T720-240H360Zm0-80h360v-480H360v480ZM200-80q-33 0-56.5-23.5T120-160v-560h80v560h440v80H200Zm160-240v-480 480Z"/></svg>',t}createBBoxRotate(){this.bboxRotateElem=document.createElement("div"),this.bboxRotateElem.style.position="absolute",this.bboxRotateElem.style.zIndex="15",this.bboxRotateElem.style.width="10px",this.bboxRotateElem.style.height="10px",this.bboxRotateElem.style.background="#fff",this.bboxRotateElem.style.border="1px solid #000",this.bboxRotateElem.style.cursor="ew-resize",this.bboxRotateElem.style.borderRadius="50%",this.bboxRotateElem.style.left="50%",this.bboxRotateElem.style.top="-25px",this.bboxRotateElem.style.transform="translateX(-50%)",this.bboxElem.appendChild(this.bboxRotateElem)}listenBBoxRotate(){let t={x:0,y:0},s=0,e=0;const l=v(this.bboxRotateElem,(n,i)=>{if(this.state!=="SELECTED")return;i.stopPropagation(),i.preventDefault(),this.state="ROTATE",t=n;const a=parseFloat(this.bboxElem.style.left),r=parseFloat(this.bboxElem.style.top),o=parseFloat(this.bboxElem.style.width),p=parseFloat(this.bboxElem.style.height),m=a+o/2,b=r+p/2;s=Math.atan2(t.y-b,t.x-m),e=s+0}),c=f(this.toolsArea,(n,i)=>{if(this.state!=="ROTATE")return;i.stopPropagation(),i.preventDefault();const a=parseFloat(this.bboxElem.style.left),r=parseFloat(this.bboxElem.style.top),o=parseFloat(this.bboxElem.style.width),p=parseFloat(this.bboxElem.style.height),m=a+o/2,b=r+p/2,B=Math.atan2(n.y-b,n.x-m),A=B-e;e=B+0;for(const R of this.selectedObjects)h.focused.rotateAbout(R,A,m,b);h.focused.requestRender();const S=parseFloat(this.bboxElem.style.rotate.replace("deg",""))||0;this.bboxElem.style.rotate=S+A*(180/Math.PI)+"deg"}),x=E(this.toolsArea,(n,i)=>{if(this.state==="ROTATE"){i.stopPropagation(),i.preventDefault(),this.state="SELECTED";for(const a of this.selectedObjects)h.focused.cachePolygon(a)}});this.bboxListenDestroiers.push(l),this.bboxListenDestroiers.push(c),this.bboxListenDestroiers.push(x)}setupBBox(){this.createBBox(),this.listenBBox(),this.createBBoxScale(),this.listenBBoxScale(),this.createBBoxRotate(),this.listenBBoxRotate();const t=this.setupBBoxRemoveButton();this.bboxElem.appendChild(t);const s=this.setupBBoxTransformButton();this.bboxElem.appendChild(s);const e=this.setupBBoxFlipXButton();this.bboxElem.appendChild(e);const l=this.setupBBoxFlipYButton();this.bboxElem.appendChild(l);const c=this.setupBBoxCopyButton();this.bboxElem.appendChild(c)}handleSelect(t){this.selectedObjects=t,this.state="SELECTED",this.setupBBox()}disselect(){this.selectedObjects=[],this.state="IDLE",this.destroyBBox()}apply(){const t=w();this.toolsArea.appendChild(t.canvas),t.canvas.style.cursor="crosshair",this.instCanvas=t.canvas;let s=!1,e=[];const l=v(t.canvas,n=>{this.state!=="SELECTED"&&(s=!0,e=[n],t.ctx.strokeStyle=T(1),t.ctx.fillStyle=T(.3),t.ctx.lineWidth=3,t.ctx.setLineDash([5,5]))}),c=f(document,n=>{if(!s)return;const i=u("PEN_MIN_DIST"),a=e[e.length-1];Math.hypot(a.x-n.x,a.y-n.y)<i||(t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height),e.push(n),t.ctx.beginPath(),t.ctx.moveTo(n.x,n.y),e.forEach(o=>{t.ctx.lineTo(o.x,o.y)}),t.ctx.stroke(),t.ctx.fill(),t.ctx.closePath())}),x=E(document,n=>{if(this.state==="SELECTED"){this.state="IDLE",this.destroyBBox();return}if(!s)return;t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height),s=!1,e.push(n);const i=h.focused.lassoSelect(e);i.length!==0&&this.handleSelect(i)});return()=>{this.toolsArea.removeChild(t.canvas),this.destroyBBox(),t.destroy(),l(),c(),x()}}}C("SEL",new X,!0);class Y{constructor(){y(this,"toolsArea");this.toolsArea=document.getElementById("toolsArea")}apply(){const t=w();this.toolsArea.appendChild(t.canvas),t.canvas.style.cursor="crosshair";let s=!1,e=[];const l=v(t.canvas,n=>{s=!0,e=[n],t.ctx.strokeStyle=u("COLOR"),t.ctx.lineWidth=u("STROKE"),t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height),t.ctx.beginPath(),t.ctx.moveTo(n.x,n.y)}),c=f(document,n=>{if(!s)return;const i=u("PEN_MIN_DIST"),a=e[e.length-1];Math.hypot(a.x-n.x,a.y-n.y)<i||(t.ctx.lineTo(n.x,n.y),t.ctx.stroke(),e.push(n))}),x=E(document,n=>{s&&(t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height),s=!1,e.push(n),h.focused.appendPenPath({points:e,strokeColor:u("COLOR"),strokeWidth:u("STROKE")}),h.focused.requestRender(),h.focused.saveAsHistory())});return()=>{this.toolsArea.removeChild(t.canvas),t.destroy(),l(),c(),x()}}}C("PEN",new Y);class j{constructor(){y(this,"toolsArea");this.toolsArea=document.getElementById("toolsArea")}apply(){const t=w();this.toolsArea.appendChild(t.canvas),t.canvas.style.cursor="crosshair";let s=!1,e={x:0,y:0};const l=v(t.canvas,n=>{s=!0,e=n,h.focused.removeAt(n).length&&(h.focused.requestRender(),h.focused.saveAsHistory())}),c=f(document,n=>{if(!s||Math.hypot(e.x-n.x,e.y-n.y)<u("PEN_MIN_DIST"))return;e=n,h.focused.removeAt(n).length&&(h.focused.requestRender(),h.focused.saveAsHistory(),console.log("saveAsHistory"))}),x=E(document,n=>{if(!s)return;s=!1,h.focused.removeAt(n).length&&(h.focused.requestRender(),h.focused.saveAsHistory(),console.log("saveAsHistory"))});return()=>{this.toolsArea.removeChild(t.canvas),t.destroy(),l(),c(),x()}}}C("ERASE",new j);class k{constructor(){y(this,"toolsArea");this.toolsArea=document.getElementById("toolsArea")}apply(){const t=w();this.toolsArea.appendChild(t.canvas),t.canvas.style.cursor="crosshair";let s=!1,e={x:0,y:0};const l=v(t.canvas,n=>{s=!0,e=n,t.ctx.strokeStyle=u("COLOR"),t.ctx.lineWidth=u("STROKE"),t.ctx.setLineDash(u("DASHLINE"))}),c=f(document,n=>{if(!s)return;t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height);let{x:i,y:a}=n,o=Math.atan2(a-e.y,i-e.x)*(180/Math.PI);if(u("SNAP_RIGHT")&&(o<=u("SNAP_DEG")&&o>=-u("SNAP_DEG")&&(a=e.y,o=0),o>=90-u("SNAP_DEG")&&o<=90+u("SNAP_DEG")&&(i=e.x,o=90),(o>=180-u("SNAP_DEG")||o<=-180+u("SNAP_DEG"))&&(a=e.y,o=180),o>=-90-u("SNAP_DEG")&&o<=-90+u("SNAP_DEG")&&(i=e.x,o=-90)),g()){const p=Math.abs(i-e.x),m=Math.abs(a-e.x);p>m?(a=e.y,o=e.x<i?0:180):(i=e.x,o=e.y<a?90:-90)}t.ctx.beginPath(),t.ctx.moveTo(e.x,e.y),t.ctx.lineTo(i,a),t.ctx.stroke()}),x=E(document,n=>{if(!s)return;t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height),s=!1;let{x:i,y:a}=n,o=Math.atan2(a-e.y,i-e.x)*(180/Math.PI);if(u("SNAP_RIGHT")&&(o<=u("SNAP_DEG")&&o>=-u("SNAP_DEG")&&(a=e.y,o=0),o>=90-u("SNAP_DEG")&&o<=90+u("SNAP_DEG")&&(i=e.x,o=90),(o>=180-u("SNAP_DEG")||o<=-180+u("SNAP_DEG"))&&(a=e.y,o=180),o>=-90-u("SNAP_DEG")&&o<=-90+u("SNAP_DEG")&&(i=e.x,o=-90)),g()){const p=Math.abs(i-e.x),m=Math.abs(a-e.x);p>m?(a=e.y,o=e.x<i?0:180):(i=e.x,o=e.y<a?90:-90)}h.focused.appendLine({x1:e.x,y1:e.y,x2:i,y2:a,strokeColor:u("COLOR"),strokeWidth:u("STROKE"),dashArray:u("DASHLINE")}),h.focused.requestRender(),h.focused.saveAsHistory()});return()=>{this.toolsArea.removeChild(t.canvas),t.destroy(),l(),c(),x()}}}C("LINE",new k);class W{constructor(){y(this,"lineDash",[12,18]);y(this,"lineDestructor",null);y(this,"lineTool");y(this,"callEvenSelected",!0);y(this,"selected",!1);this.lineTool=new k}setLineDash(t){this.lineDash=t}apply(t){if(t){const s=this.setLineDash.bind(this);new P(l=>{l&&(L("DASHLINE",[l.x,l.y]),s([l.x,l.y]))},"간격 설정","기본값 (12, 18)<br />(그려지는 길이, 빈 길이) 순서 입니다.").open()}return L("DASHLINE",this.lineDash),this.lineDestructor=this.lineTool.apply(),this.selected=!0,()=>{this.selected=!1,L("DASHLINE",[]),this.lineDestructor&&this.lineDestructor()}}}C("LINE-DASH",new W);class G{constructor(){y(this,"toolsArea");this.toolsArea=document.getElementById("toolsArea")}apply(){const t=w();this.toolsArea.appendChild(t.canvas),t.canvas.style.cursor="crosshair";let s=!1,e={x:0,y:0};const l=v(t.canvas,n=>{s=!0,e=n,t.ctx.strokeStyle=u("COLOR"),t.ctx.lineWidth=u("STROKE")}),c=f(document,n=>{if(!s)return;t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height);let i=n.x-e.x,a=n.y-e.y;if(g()){const r=Math.abs(i),o=Math.abs(a),p=Math.min(r,o);i=i<0?-p:p,a=a<0?-p:p}t.ctx.strokeRect(e.x,e.y,i,a)}),x=E(document,n=>{if(!s)return;t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height),s=!1;let i=e.x,a=e.y,r=n.x-e.x,o=n.y-e.y;if(g()){const p=Math.abs(r),m=Math.abs(o),b=Math.min(p,m);r=r<0?-b:b,o=o<0?-b:b}r<0&&(i=n.x,r=-r),o<0&&(a=n.y,o=-o),h.focused.appendRectangle({x:i,y:a,width:r,height:o,fillColor:"transparent",strokeColor:u("COLOR"),strokeWidth:u("STROKE")}),h.focused.requestRender(),h.focused.saveAsHistory()});return()=>{this.toolsArea.removeChild(t.canvas),t.destroy(),l(),c(),x()}}}C("RECT",new G);class z{constructor(){y(this,"toolsArea");this.toolsArea=document.getElementById("toolsArea")}apply(){const t=w();this.toolsArea.appendChild(t.canvas),t.canvas.style.cursor="crosshair";let s=!1,e={x:0,y:0};const l=v(t.canvas,n=>{s=!0,e=n,t.ctx.strokeStyle=u("COLOR"),t.ctx.lineWidth=u("STROKE")}),c=f(document,n=>{if(!s)return;t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height);let i=n.x-e.x,a=n.y-e.y,r=Math.abs(i/2),o=Math.abs(a/2);if(g()){const b=Math.min(r,o);r=b,o=b}const p=e.x+(i>0?r:-r),m=e.y+(a>0?o:-o);t.ctx.beginPath(),t.ctx.ellipse(p,m,r,o,0,0,2*Math.PI),t.ctx.stroke()}),x=E(document,n=>{if(!s)return;t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height),s=!1;let i=n.x-e.x,a=n.y-e.y,r=Math.abs(i/2),o=Math.abs(a/2);if(g()){const b=Math.min(r,o);r=b,o=b}const p=e.x+(i>0?r:-r),m=e.y+(a>0?o:-o);h.focused.appendCircle({x:p,y:m,xRadius:r,yRadius:o,fillColor:"transparent",strokeColor:u("COLOR"),strokeWidth:u("STROKE")}),h.focused.requestRender(),h.focused.saveAsHistory()});return()=>{this.toolsArea.removeChild(t.canvas),t.destroy(),l(),c(),x()}}}C("ELIP",new z);class K{constructor(){y(this,"toolsArea");this.toolsArea=document.getElementById("toolsArea")}apply(){const t=w();this.toolsArea.appendChild(t.canvas),t.canvas.style.cursor="crosshair";let s=!1,e={x:0,y:0};const l=v(t.canvas,n=>{s=!0,e=n,t.ctx.strokeStyle=u("COLOR"),t.ctx.lineWidth=u("STROKE")}),c=f(document,n=>{if(!s)return;t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height);let i=n.x-e.x,a=n.y-e.y;if(g()){const o=Math.min(Math.abs(i),Math.abs(a));i=(i>0?1:-1)*o,a=(a>0?1:-1)*o*Math.sqrt(3)/2}let r=e.y;a>0&&(a=-a,r-=a),t.ctx.beginPath(),t.ctx.moveTo(e.x,r),t.ctx.lineTo(e.x+i,r),t.ctx.lineTo(e.x+i/2,r+a),t.ctx.closePath(),t.ctx.stroke()}),x=E(document,n=>{if(!s)return;t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height),s=!1;let i=n.x-e.x,a=n.y-e.y;if(g()){const p=Math.min(Math.abs(i),Math.abs(a));i=(i>0?1:-1)*p,a=(a>0?1:-1)*p*Math.sqrt(3)/2}let r=e.x,o=e.y;i<0&&(r+=i,i=-i),a<0&&(o+=a,a=-a),h.focused.appendTriangle({x1:r,y1:o+a,x2:r+i,y2:o+a,x3:r+i/2,y3:o,fillColor:"transparent",strokeColor:u("COLOR"),strokeWidth:u("STROKE")}),h.focused.requestRender(),h.focused.saveAsHistory()});return()=>{this.toolsArea.removeChild(t.canvas),t.destroy(),l(),c(),x()}}}C("TRI",new K);
