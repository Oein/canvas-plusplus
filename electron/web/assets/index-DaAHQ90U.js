var j=Object.defineProperty;var W=(u,t,e)=>t in u?j(u,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[t]=e;var f=(u,t,e)=>W(u,typeof t!="symbol"?t+"":t,e);import{b as R,m as c,e as H,g as b,i as w,s as S}from"./index--J-M3p4_.js";class k{constructor(t,e,s){f(this,"modal");f(this,"xInput");f(this,"yInput");f(this,"keypad");f(this,"confirmButton");f(this,"cancelButton");f(this,"keypadVisible",!1);f(this,"activeInput");this.onDone=t,this.modal=document.createElement("div"),this.modal.className="modalWRP";const r=document.createElement("div");if(r.className="modalCTT",e){const n=document.createElement("h2");n.textContent=e,n.style.marginBottom=".5rem",n.style.marginTop="0",n.style.padding="0",n.style.textAlign="center",r.appendChild(n)}if(s){const n=document.createElement("p");n.innerHTML=s,n.style.marginBottom="10px",n.style.marginTop="0",n.style.padding="0",n.style.fontSize="14px",n.style.color="#666",n.style.textAlign="center",r.appendChild(n)}const d=document.createElement("div");d.style.display="flex",d.style.alignItems="center",d.style.marginBottom="15px";const p=document.createElement("label");p.textContent="X:",p.style.marginRight="10px",this.xInput=document.createElement("input"),this.xInput.type="text",this.xInput.style.flex="1",this.xInput.style.padding="10px",this.xInput.style.border="1px solid #ccc",this.xInput.style.borderRadius="4px",this.xInput.style.boxSizing="border-box";const i=document.createElement("button");i.textContent="⌨️",i.style.marginLeft="10px",i.style.padding="5px",i.style.border="1px solid #ccc",i.style.borderRadius="4px",i.style.cursor="pointer",i.style.height="40px",i.style.width="40px",i.style.textAlign="center",i.addEventListener("click",()=>this.toggleKeypad(this.xInput)),d.appendChild(p),d.appendChild(this.xInput),d.appendChild(i);const l=document.createElement("div");l.style.display="flex",l.style.alignItems="center",l.style.marginBottom="15px";const a=document.createElement("label");a.textContent="Y:",a.style.marginRight="10px",this.yInput=document.createElement("input"),this.yInput.type="text",this.yInput.style.flex="1",this.yInput.style.padding="10px",this.yInput.style.border="1px solid #ccc",this.yInput.style.borderRadius="4px",this.yInput.style.boxSizing="border-box";const o=document.createElement("button");o.textContent="⌨️",o.style.marginLeft="10px",o.style.padding="5px",o.style.border="1px solid #ccc",o.style.borderRadius="4px",o.style.cursor="pointer",o.style.height="40px",o.style.width="40px",o.style.textAlign="center",o.addEventListener("click",()=>this.toggleKeypad(this.yInput)),l.appendChild(a),l.appendChild(this.yInput),l.appendChild(o),this.confirmButton=document.createElement("button"),this.confirmButton.textContent="Confirm",this.confirmButton.style.marginRight="10px",this.confirmButton.style.padding="10px 20px",this.confirmButton.style.border="none",this.confirmButton.style.backgroundColor="#007bff",this.confirmButton.style.color="#fff",this.confirmButton.style.borderRadius="4px",this.confirmButton.style.cursor="pointer",this.cancelButton=document.createElement("button"),this.cancelButton.textContent="Cancel",this.cancelButton.style.padding="10px 20px",this.cancelButton.style.border="none",this.cancelButton.style.backgroundColor="#ccc",this.cancelButton.style.color="#000",this.cancelButton.style.borderRadius="4px",this.cancelButton.style.cursor="pointer",this.keypad=document.createElement("div"),this.keypad.style.position="absolute",this.keypad.style.right="-150px",this.keypad.style.top="20px",this.keypad.style.width="150px",this.keypad.style.backgroundColor="#fff",this.keypad.style.border="1px solid #ccc",this.keypad.style.borderRadius="8px",this.keypad.style.boxShadow="0 4px 8px rgba(0, 0, 0, 0.1)",this.keypad.style.display="none",this.keypad.style.gridTemplateColumns="repeat(3, 1fr)",this.keypad.style.gap="10px",this.keypad.style.padding="10px",this.keypad.style.boxSizing="border-box",this.keypad.style.gridAutoRows="40px",["1","2","3","4","5","6","7","8","9","-","0","←"].forEach(n=>{const h=document.createElement("button");h.textContent=n,h.style.padding="10px",h.style.border="1px solid #ccc",h.style.borderRadius="4px",h.style.cursor="pointer",h.addEventListener("click",()=>{n==="←"?this.activeInput.value=this.activeInput.value.slice(0,-1):this.activeInput.value+=n}),this.keypad.appendChild(h)}),r.appendChild(d),r.appendChild(l),r.appendChild(this.confirmButton),r.appendChild(this.cancelButton),r.appendChild(this.keypad),this.modal.appendChild(r),this.confirmButton.addEventListener("click",()=>this.onConfirm()),this.cancelButton.addEventListener("click",()=>this.onCancel())}toggleKeypad(t){this.activeInput=t,this.keypadVisible=!this.keypadVisible,this.keypad.style.display=this.keypadVisible?"grid":"none"}onConfirm(){const t=parseFloat(this.xInput.value),e=parseFloat(this.yInput.value);if(isNaN(t)||isNaN(e)){alert("Please enter valid numbers for both coordinates.");return}this.onDone({x:t,y:e}),this.close()}onCancel(){this.onDone(null),this.close()}close(){this.modal.parentElement&&this.modal.parentElement.removeChild(this.modal)}open(){document.body.appendChild(this.modal),this.xInput.focus()}}function T(){const u=document.createElement("canvas"),t=u.getContext("2d");if(!t)throw new Error("Failed to create canvas context");u.width=window.innerWidth,u.height=window.innerHeight;const e=()=>{u.width=window.innerWidth,u.height=window.innerHeight};return window.addEventListener("resize",e),{canvas:u,ctx:t,destroy:()=>window.removeEventListener("resize",e)}}let M=1;function I(u=1){return M+=3,M%=360,`hsla(${M}, 100%, 50%, ${u})`}function D(u){if("targetTouches"in u){if(u.targetTouches.item(0))u.preventDefault();else return{x:-1,y:-1};return{x:u.targetTouches.item(0).pageX,y:u.targetTouches.item(0).pageY}}else return{x:u.pageX||u.offsetX||u.clientX,y:u.pageY||u.offsetY||u.clientY}}function g(u,t){const e=r=>{t(D(r),r)},s=r=>{r.preventDefault()};return u.addEventListener("pointermove",e),u.addEventListener("touchmove",s),()=>{u.removeEventListener("pointermove",e),u.removeEventListener("touchmove",s)}}function B(u,t){const e=r=>{t(D(r),r)},s=r=>{r.preventDefault()};return u.addEventListener("pointerdown",e),u.addEventListener("touchstart",s),()=>{u.removeEventListener("pointerdown",e),u.removeEventListener("touchstart",s)}}function C(u,t){const e=r=>{t(D(r),r)},s=r=>{r.preventDefault()};return u.addEventListener("pointerup",e),u.addEventListener("touchend",s),()=>{u.removeEventListener("pointerup",e),u.removeEventListener("touchend",s)}}const L=navigator.userAgent.toLowerCase(),K=L.indexOf("mac")>-1&&L.indexOf("os")>-1&&!(L.indexOf("iphone")>-1||L.indexOf("ipad")>-1||L.indexOf("windows")>-1);class X{constructor(){f(this,"toolsArea");f(this,"bboxElem");f(this,"bboxScaleElem");f(this,"bboxRotateElem");f(this,"selectedObjects",[]);f(this,"instCanvas");f(this,"state","IDLE");f(this,"bboxListenDestroiers",[]);f(this,"nextBBoxColor",null);this.toolsArea=document.getElementById("toolsArea")}createBBox(){this.bboxElem=document.createElement("div"),this.bboxElem.style.position="fixed",this.bboxElem.style.border="1px dashed "+I(1),this.bboxElem.style.background=this.nextBBoxColor||I(.3),this.bboxElem.style.zIndex="15",this.nextBBoxColor=null;const t=this.selectedObjects.map(p=>c.focused.cachecdPolygon[p]);let e=1/0,s=1/0,r=-1/0,d=-1/0;for(const p of t)for(const i of p)e=Math.min(e,i.x),s=Math.min(s,i.y),r=Math.max(r,i.x),d=Math.max(d,i.y);this.bboxElem.style.left=e+"px",this.bboxElem.style.top=s+"px",this.bboxElem.style.width=r-e+"px",this.bboxElem.style.height=d-s+"px",this.bboxElem.style.cursor="move",this.toolsArea.appendChild(this.bboxElem)}listenBBoxMove(){let t={x:0,y:0},e=-1,s=1;const r=B(this.bboxElem,(i,l)=>{this.state==="SELECTED"&&(l.stopPropagation(),l.preventDefault(),this.state="MOVING",t=i,this.instCanvas.style.cursor="move",s=1,e=-1)}),d=g(this.toolsArea,(i,l)=>{if(this.state!=="MOVING")return;e===-1&&(e=w()?1:0),e&&(s=b("LITTLE_MOVE_MULTIPLIER")),l.stopPropagation(),l.preventDefault();let a=i.x-t.x,o=i.y-t.y;a*=s,o*=s,t=i;for(const y of this.selectedObjects)c.focused.transform(y,a,o);c.focused.requestRender();const n=parseFloat(this.bboxElem.style.left),h=parseFloat(this.bboxElem.style.top);this.bboxElem.style.left=n+a+"px",this.bboxElem.style.top=h+o+"px"}),p=C(this.toolsArea,(i,l)=>{if(this.state==="MOVING"){l.stopPropagation(),l.preventDefault(),this.state="SELECTED";for(const a of this.selectedObjects)c.focused.cachePolygon(a);this.instCanvas.style.cursor="crosshair",c.focused.saveAsHistory()}});this.bboxListenDestroiers.push(r),this.bboxListenDestroiers.push(d),this.bboxListenDestroiers.push(p)}destroyBBox(){this.bboxElem&&this.bboxElem.remove();for(const t of this.bboxListenDestroiers)t();this.bboxListenDestroiers=[]}createBBoxScale(){this.bboxScaleElem=document.createElement("div"),this.bboxScaleElem.style.position="absolute",this.bboxScaleElem.style.zIndex="15",this.bboxScaleElem.style.width="10px",this.bboxScaleElem.style.height="10px",this.bboxScaleElem.style.background="#fff",this.bboxScaleElem.style.border="1px solid #000",this.bboxScaleElem.style.cursor="nwse-resize",this.bboxScaleElem.style.right="-5px",this.bboxScaleElem.style.bottom="-5px",this.bboxElem.appendChild(this.bboxScaleElem)}listenBBoxScale(){let t={x:0,y:0},e={x:0,y:0},s=0,r=0,d=0,p=0;const i=B(this.bboxScaleElem,(o,n)=>{this.state==="SELECTED"&&(n.stopPropagation(),n.preventDefault(),this.state="SCALE",t=o,e={...o},d=parseFloat(this.bboxElem.style.width),p=parseFloat(this.bboxElem.style.height),s=d+0,r=p+0,this.instCanvas.style.cursor="nwse-resize")}),l=g(this.toolsArea,(o,n)=>{if(this.state!=="SCALE")return;n.stopPropagation(),n.preventDefault();let h=o.x-t.x,y=o.y-t.y,x=d+h,m=p+y,v=x/d,E=m/p;if(w()){let A=o.x-e.x,q=o.y-e.y,_=s+A,F=r+q,Z=_/s,N=F/r,O=Math.min(Z,N);x=s*O,m=r*O,v=x/d,E=m/p}d=x,p=m,this.bboxElem.style.width=x+"px",this.bboxElem.style.height=m+"px",t=o;for(const A of this.selectedObjects)c.focused.scaleAboutRect(A,{x:parseFloat(this.bboxElem.style.left),y:parseFloat(this.bboxElem.style.top),width:d,height:p},v,E);c.focused.requestRender()}),a=C(this.toolsArea,(o,n)=>{if(this.state==="SCALE"){n.stopPropagation(),n.preventDefault(),this.state="SELECTED";for(const h of this.selectedObjects)c.focused.cachePolygon(h);this.instCanvas.style.cursor="crosshair",c.focused.saveAsHistory()}});this.bboxListenDestroiers.push(i),this.bboxListenDestroiers.push(l),this.bboxListenDestroiers.push(a)}setupBBoxToolButton(t,e){switch(e.style.position="absolute",e.style.width="20px",e.style.height="20px",e.style.backgroundColor="white",e.style.color="black",e.style.textAlign="center",e.style.lineHeight="20px",e.style.cursor="pointer",e.style.border="1px solid black",e.style.display="flex",e.style.justifyContent="center",e.style.alignItems="center",e.style.zIndex="10000000",e.style.pointerEvents="all",t){case"REMOVE":e.style.left="-30px",e.style.top="0px";break;case"TRANSFORM":e.style.left="-30px",e.style.top="20px";break;case"FLIPX":e.style.left="-30px",e.style.top="40px";break;case"FLIPY":e.style.left="-30px",e.style.top="60px";break;case"COPY":e.style.right="-30px",e.style.top="0px";break;case"COPY2CLIPBOARD":e.style.right="-30px",e.style.top="30px";break}}setupBBoxButtonEventHandler(t,e){t.addEventListener("pointerup",s=>{s.preventDefault(),setTimeout(()=>e(),3)})}setupBBoxRemoveButton(){const t=document.createElement("div");return this.setupBBoxToolButton("REMOVE",t),this.setupBBoxButtonEventHandler(t,()=>{for(let e=0;e<this.selectedObjects.length;e++)c.focused.removeElement(this.selectedObjects[e]);c.focused.requestRender(),c.focused.saveAsHistory(),this.disselect()}),t.innerHTML='<svg style="width: 20px; height: 20px;"  xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#000"><path d="M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160 0h80v-360h-80v360ZM280-720v520-520Z"/></svg>',t}setupBBoxTransformButton(){const t=document.createElement("div");this.setupBBoxToolButton("TRANSFORM",t);const e=this.handleSelect.bind(this);return this.setupBBoxButtonEventHandler(t,()=>{const s=[...this.selectedObjects];new k(d=>{if(d!==null){for(let p=0;p<this.selectedObjects.length;p++)c.focused.transform(this.selectedObjects[p],d.x,d.y),c.focused.cachePolygon(this.selectedObjects[p]);c.focused.requestRender(),c.focused.saveAsHistory(),setTimeout(()=>{e(s)},3)}},"이동","상대적 좌표가 필요합니다").open()}),t.innerHTML='<svg style="width: 20px; height: 20px;" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="#000"><path d="M440-40v-167l-44 43-56-56 140-140 140 140-56 56-44-43v167h-80ZM220-340l-56-56 43-44H40v-80h167l-43-44 56-56 140 140-140 140Zm520 0L600-480l140-140 56 56-43 44h167v80H753l43 44-56 56Zm-260-80q-25 0-42.5-17.5T420-480q0-25 17.5-42.5T480-540q25 0 42.5 17.5T540-480q0 25-17.5 42.5T480-420Zm0-180L340-740l56-56 44 43v-167h80v167l44-43 56 56-140 140Z"/></svg>',t}setupBBoxFlipXButton(){const t=document.createElement("div");return this.setupBBoxToolButton("FLIPX",t),this.setupBBoxButtonEventHandler(t,()=>{const e=parseFloat(this.bboxElem.style.left),s=parseFloat(this.bboxElem.style.width),r=e+s/2;for(const d of this.selectedObjects)c.focused.flipX(d,r);c.focused.requestRender(),c.focused.saveAsHistory()}),t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentcolor"><path d="M360-120H200q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h160v80H200v560h160v80Zm80 80v-880h80v880h-80Zm160-80v-80h80v80h-80Zm0-640v-80h80v80h-80Zm160 640v-80h80q0 33-23.5 56.5T760-120Zm0-160v-80h80v80h-80Zm0-160v-80h80v80h-80Zm0-160v-80h80v80h-80Zm0-160v-80q33 0 56.5 23.5T840-760h-80Z"/></svg>',t}setupBBoxFlipYButton(){const t=document.createElement("div");return this.setupBBoxToolButton("FLIPY",t),this.setupBBoxButtonEventHandler(t,()=>{const e=parseFloat(this.bboxElem.style.top),s=parseFloat(this.bboxElem.style.height),r=e+s/2;for(const d of this.selectedObjects)c.focused.flipY(d,r);c.focused.requestRender(),c.focused.saveAsHistory()}),t.innerHTML='<svg style="rotate: 90deg;" xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentcolor"><path d="M360-120H200q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h160v80H200v560h160v80Zm80 80v-880h80v880h-80Zm160-80v-80h80v80h-80Zm0-640v-80h80v80h-80Zm160 640v-80h80q0 33-23.5 56.5T760-120Zm0-160v-80h80v80h-80Zm0-160v-80h80v80h-80Zm0-160v-80h80v80h-80Zm0-160v-80q33 0 56.5 23.5T840-760h-80Z"/></svg>',t}setupBBoxCopyButton(){const t=document.createElement("div");return this.setupBBoxToolButton("COPY",t),this.setupBBoxButtonEventHandler(t,()=>{const e=[];for(let s=0;s<this.selectedObjects.length;s++){const r=c.focused.cloneObject(this.selectedObjects[s]);e.push(r)}c.focused.requestRender(),this.disselect(),setTimeout(()=>{this.nextBBoxColor="#575B977F",this.handleSelect(e)},3)}),t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentcolor"><path d="M360-240q-33 0-56.5-23.5T280-320v-480q0-33 23.5-56.5T360-880h360q33 0 56.5 23.5T800-800v480q0 33-23.5 56.5T720-240H360Zm0-80h360v-480H360v480ZM200-80q-33 0-56.5-23.5T120-160v-560h80v560h440v80H200Zm160-240v-480 480Z"/></svg>',t}setupBBoxCopy2clipboardButton(){const t=document.createElement("div");return this.setupBBoxToolButton("COPY2CLIPBOARD",t),this.setupBBoxButtonEventHandler(t,()=>{c.focused.getClipboardData(this.selectedObjects).then(e=>{const s=H(e);let r=b("CLIPBOARD_PREFIX");for(let i=0;i<s.length;i++)r+=String.fromCharCode(s[i]);const d="text/plain",p=new Blob([r],{type:d});navigator.clipboard.write([new ClipboardItem({[d]:p})])})}),t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentcolor"><path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h167q11-35 43-57.5t70-22.5q40 0 71.5 22.5T594-840h166q33 0 56.5 23.5T840-760v560q0 33-23.5 56.5T760-120H200Zm0-80h560v-560h-80v120H280v-120h-80v560Zm280-560q17 0 28.5-11.5T520-800q0-17-11.5-28.5T480-840q-17 0-28.5 11.5T440-800q0 17 11.5 28.5T480-760Z"/></svg>',t}createBBoxRotate(){this.bboxRotateElem=document.createElement("div"),this.bboxRotateElem.style.position="absolute",this.bboxRotateElem.style.zIndex="15",this.bboxRotateElem.style.width="10px",this.bboxRotateElem.style.height="10px",this.bboxRotateElem.style.background="#fff",this.bboxRotateElem.style.border="1px solid #000",this.bboxRotateElem.style.cursor="ew-resize",this.bboxRotateElem.style.borderRadius="50%",this.bboxRotateElem.style.left="50%",this.bboxRotateElem.style.top="-25px",this.bboxRotateElem.style.transform="translateX(-50%)",this.bboxElem.appendChild(this.bboxRotateElem)}listenBBoxRotate(){let t={x:0,y:0},e=0,s=0;const r=B(this.bboxRotateElem,(i,l)=>{if(this.state!=="SELECTED")return;l.stopPropagation(),l.preventDefault(),this.state="ROTATE",t=i;const a=parseFloat(this.bboxElem.style.left),o=parseFloat(this.bboxElem.style.top),n=parseFloat(this.bboxElem.style.width),h=parseFloat(this.bboxElem.style.height),y=a+n/2,x=o+h/2;e=Math.atan2(t.y-x,t.x-y),s=e+0}),d=g(this.toolsArea,(i,l)=>{if(this.state!=="ROTATE")return;l.stopPropagation(),l.preventDefault();const a=parseFloat(this.bboxElem.style.left),o=parseFloat(this.bboxElem.style.top),n=parseFloat(this.bboxElem.style.width),h=parseFloat(this.bboxElem.style.height),y=a+n/2,x=o+h/2,m=Math.atan2(i.y-x,i.x-y),v=m-s;s=m+0;for(const A of this.selectedObjects)c.focused.rotateAbout(A,v,y,x);c.focused.requestRender();const E=parseFloat(this.bboxElem.style.rotate.replace("deg",""))||0;this.bboxElem.style.rotate=E+v*(180/Math.PI)+"deg"}),p=C(this.toolsArea,(i,l)=>{if(this.state==="ROTATE"){l.stopPropagation(),l.preventDefault(),this.state="SELECTED";for(const a of this.selectedObjects)c.focused.cachePolygon(a);this.selectedObjects.length>0&&c.focused.saveAsHistory()}});this.bboxListenDestroiers.push(r),this.bboxListenDestroiers.push(d),this.bboxListenDestroiers.push(p)}setupBBox(){this.createBBox(),this.listenBBoxMove(),this.createBBoxScale(),this.listenBBoxScale(),this.createBBoxRotate(),this.listenBBoxRotate();const t=this.setupBBoxRemoveButton();this.bboxElem.appendChild(t);const e=this.setupBBoxTransformButton();this.bboxElem.appendChild(e);const s=this.setupBBoxFlipXButton();this.bboxElem.appendChild(s);const r=this.setupBBoxFlipYButton();this.bboxElem.appendChild(r);const d=this.setupBBoxCopyButton();this.bboxElem.appendChild(d);const p=this.setupBBoxCopy2clipboardButton();this.bboxElem.appendChild(p);const i=l=>{l.key==="c"&&(K?l.metaKey:l.ctrlKey)&&(console.log("copy2clipboard"),c.focused.getClipboardData(this.selectedObjects).then(a=>{const o=H(a);let n=b("CLIPBOARD_PREFIX");for(let x=0;x<o.length;x++)n+=String.fromCharCode(o[x]);const h="text/plain",y=new Blob([n],{type:h});navigator.clipboard.write([new ClipboardItem({[h]:y})])}))};document.addEventListener("keydown",i),this.bboxListenDestroiers.push(()=>{document.removeEventListener("keydown",i)})}handleSelect(t){this.selectedObjects=t,this.state="SELECTED",this.setupBBox()}disselect(){this.selectedObjects=[],this.state="IDLE",this.destroyBBox()}apply(){const t=T();this.toolsArea.appendChild(t.canvas),t.canvas.style.cursor="crosshair",this.instCanvas=t.canvas;let e=!1,s=[];const r=B(t.canvas,i=>{this.state!=="SELECTED"&&(e=!0,s=[i],t.ctx.strokeStyle=I(1),t.ctx.fillStyle=I(.3),t.ctx.lineWidth=3,t.ctx.setLineDash([5,5]))}),d=g(document,i=>{if(!e)return;const l=b("PEN_MIN_DIST"),a=s[s.length-1];Math.hypot(a.x-i.x,a.y-i.y)<l||(t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height),s.push(i),t.ctx.beginPath(),t.ctx.moveTo(i.x,i.y),s.forEach(n=>{t.ctx.lineTo(n.x,n.y)}),t.ctx.stroke(),t.ctx.fill(),t.ctx.closePath())}),p=C(document,i=>{if(this.state==="SELECTED"){this.state="IDLE",this.destroyBBox();return}if(!e)return;if(t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height),e=!1,s.push(i),s.length<10){const a=s.reduce((h,y)=>h+y.x,0)/s.length,o=s.reduce((h,y)=>h+y.y,0)/s.length,n=c.focused.pointSelect({x:a,y:o});if(n.length==0)return;this.handleSelect(n);return}const l=c.focused.lassoSelect(s);l.length!==0&&this.handleSelect(l)});return()=>{this.toolsArea.removeChild(t.canvas),this.destroyBBox(),t.destroy(),r(),d(),p()}}}R("SEL",new X,!0);class Y{constructor(){f(this,"toolsArea");this.toolsArea=document.getElementById("toolsArea")}apply(){const t=T();this.toolsArea.appendChild(t.canvas),t.canvas.style.cursor="crosshair";let e=!1,s=!1,r={x:0,y:0},d=[];const p=o=>{b("RCLICK2ERASE")&&o.preventDefault()};t.canvas.addEventListener("contextmenu",p);const i=B(t.canvas,(o,n)=>{if(e=!0,n.pointerType=="mouse"&&n.button==2&&b("RCLICK2ERASE")){n.preventDefault(),s=!0,r=o,c.focused.removeAt(o).length&&(c.focused.requestRender(),c.focused.saveAsHistory());return}d=[o],t.ctx.strokeStyle=b("COLOR"),t.ctx.lineWidth=b("STROKE"),t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height),t.ctx.beginPath(),t.ctx.moveTo(o.x,o.y)}),l=g(document,(o,n)=>{if(!e)return;if(s){if(n.preventDefault(),Math.hypot(r.x-o.x,r.y-o.y)<1)return;r=o,c.focused.removeAt(o).length&&(c.focused.requestRender(),c.focused.saveAsHistory(),console.log("saveAsHistory"));return}const h=b("PEN_MIN_DIST"),y=d[d.length-1];Math.hypot(y.x-o.x,y.y-o.y)<h||(t.ctx.lineTo(o.x,o.y),t.ctx.stroke(),d.push(o))}),a=C(document,(o,n)=>{if(e){if(t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height),e=!1,s){n.preventDefault(),c.focused.removeAt(o).length&&(c.focused.requestRender(),c.focused.saveAsHistory(),console.log("saveAsHistory")),s=!1;return}d.push(o),c.focused.appendPenPath({points:d,strokeColor:b("COLOR"),strokeWidth:b("STROKE")}),c.focused.requestRender(),c.focused.saveAsHistory()}});return()=>{this.toolsArea.removeChild(t.canvas),t.destroy(),i(),l(),a(),t.canvas.removeEventListener("contextmenu",p)}}}R("PEN",new Y);class z{constructor(){f(this,"toolsArea");this.toolsArea=document.getElementById("toolsArea")}apply(){const t=T();this.toolsArea.appendChild(t.canvas),t.canvas.style.cursor="crosshair";let e=!1,s={x:0,y:0};const r=B(t.canvas,i=>{e=!0,s=i,c.focused.removeAt(i).length&&(c.focused.requestRender(),c.focused.saveAsHistory())}),d=g(document,i=>{if(!e||Math.hypot(s.x-i.x,s.y-i.y)<1)return;s=i,c.focused.removeAt(i).length&&(c.focused.requestRender(),c.focused.saveAsHistory(),console.log("saveAsHistory"))}),p=C(document,i=>{if(!e)return;e=!1,c.focused.removeAt(i).length&&(c.focused.requestRender(),c.focused.saveAsHistory(),console.log("saveAsHistory"))});return()=>{this.toolsArea.removeChild(t.canvas),t.destroy(),r(),d(),p()}}}R("ERASE",new z);class P{constructor(){f(this,"toolsArea");this.toolsArea=document.getElementById("toolsArea")}apply(){const t=T();this.toolsArea.appendChild(t.canvas),t.canvas.style.cursor="crosshair";let e=!1,s={x:0,y:0};const r=(l,a,o,n,h)=>{let y,x,m,v,E;switch(h){case 0:return{x:o,y:a};case 45:return y=o-l,x=n-a,m=Math.abs(Math.min(y,x)),v=y<0?-1:1,E=x<0?-1:1,{x:l+m*v,y:a+m*E};case 90:return{x:l,y:n};case 135:return y=o-l,x=n-a,m=Math.abs(Math.min(y,x)),v=y<0?-1:1,E=x<0?-1:1,{x:l+m*v,y:a+m*E};case 180:return{x:o,y:a};case-45:return y=o-l,x=n-a,m=Math.abs(Math.min(y,x)),v=y<0?-1:1,E=x<0?-1:1,{x:l+m*v,y:a+m*E};case-90:return{x:l,y:n};case-135:return y=o-l,x=n-a,m=Math.abs(Math.min(y,x)),v=y<0?-1:1,E=x<0?-1:1,{x:l+m*v,y:a+m*E};case-180:return{x:o,y:a}}return{x:o,y:n}},d=B(t.canvas,l=>{e=!0,s=l,t.ctx.strokeStyle=b("COLOR"),t.ctx.lineWidth=b("STROKE"),t.ctx.setLineDash(b("DASHLINE"))}),p=g(document,l=>{if(!e)return;t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height);let{x:a,y:o}=l,h=Math.atan2(o-s.y,a-s.x)*(180/Math.PI);if(b("SNAP_RIGHT"))for(let x=0;x<360/45;x++){let m=x*45;if(m>180&&(m-=360),h<=m+b("SNAP_DEG")&&h>=m-b("SNAP_DEG")){h=m;break}}w()&&(h=Math.round(h/45)*45);const y=r(s.x,s.y,a,o,h);a=y.x,o=y.y,t.ctx.beginPath(),t.ctx.moveTo(s.x,s.y),t.ctx.lineTo(a,o),t.ctx.stroke()}),i=C(document,l=>{if(!e)return;t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height),e=!1;let{x:a,y:o}=l,h=Math.atan2(o-s.y,a-s.x)*(180/Math.PI);if(b("SNAP_RIGHT"))for(let x=0;x<360/45;x++){let m=x*45;if(m>180&&(m-=360),h<=m+b("SNAP_DEG")&&h>=m-b("SNAP_DEG")){h=m;break}}w()&&(h=Math.round(h/45)*45);const y=r(s.x,s.y,a,o,h);a=y.x,o=y.y,c.focused.appendLine({x1:s.x,y1:s.y,x2:a,y2:o,strokeColor:b("COLOR"),strokeWidth:b("STROKE"),dashArray:b("DASHLINE")}),c.focused.requestRender(),c.focused.saveAsHistory()});return()=>{this.toolsArea.removeChild(t.canvas),t.destroy(),d(),p(),i()}}}R("LINE",new P);class V{constructor(){f(this,"lineDash",[12,18]);f(this,"lineDestructor",null);f(this,"lineTool");f(this,"callEvenSelected",!0);f(this,"selected",!1);this.lineTool=new P}setLineDash(t){this.lineDash=t}apply(t){if(t){const e=this.setLineDash.bind(this);new k(r=>{r&&(S("DASHLINE",[r.x,r.y]),e([r.x,r.y]))},"간격 설정","기본값 (12, 18)<br />(그려지는 길이, 빈 길이) 순서 입니다.").open()}return S("DASHLINE",this.lineDash),this.lineDestructor=this.lineTool.apply(),this.selected=!0,()=>{this.selected=!1,S("DASHLINE",[]),this.lineDestructor&&this.lineDestructor()}}}R("LINE-DASH",new V);class G{constructor(){f(this,"toolsArea");this.toolsArea=document.getElementById("toolsArea")}apply(){const t=T();this.toolsArea.appendChild(t.canvas),t.canvas.style.cursor="crosshair";let e=!1,s={x:0,y:0};const r=B(t.canvas,i=>{e=!0,s=i,t.ctx.strokeStyle=b("COLOR"),t.ctx.lineWidth=b("STROKE")}),d=g(document,i=>{if(!e)return;t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height);let l=i.x-s.x,a=i.y-s.y;if(w()){const o=Math.abs(l),n=Math.abs(a),h=Math.min(o,n);l=l<0?-h:h,a=a<0?-h:h}t.ctx.strokeRect(s.x,s.y,l,a)}),p=C(document,i=>{if(!e)return;t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height),e=!1;let l=s.x,a=s.y,o=i.x-s.x,n=i.y-s.y;if(w()){const h=Math.abs(o),y=Math.abs(n),x=Math.min(h,y);o=o<0?-x:x,n=n<0?-x:x}o<0&&(l=i.x,o=-o),n<0&&(a=i.y,n=-n),c.focused.appendRectangle({x:l,y:a,width:o,height:n,fillColor:"transparent",strokeColor:b("COLOR"),strokeWidth:b("STROKE")}),c.focused.requestRender(),c.focused.saveAsHistory()});return()=>{this.toolsArea.removeChild(t.canvas),t.destroy(),r(),d(),p()}}}R("RECT",new G);class U{constructor(){f(this,"toolsArea");this.toolsArea=document.getElementById("toolsArea")}apply(){const t=T();this.toolsArea.appendChild(t.canvas),t.canvas.style.cursor="crosshair";let e=!1,s={x:0,y:0};const r=B(t.canvas,i=>{e=!0,s=i,t.ctx.strokeStyle=b("COLOR"),t.ctx.lineWidth=b("STROKE")}),d=g(document,i=>{if(!e)return;t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height);let l=i.x-s.x,a=i.y-s.y,o=Math.abs(l/2),n=Math.abs(a/2);if(w()){const x=Math.min(o,n);o=x,n=x}const h=s.x+(l>0?o:-o),y=s.y+(a>0?n:-n);t.ctx.beginPath(),t.ctx.ellipse(h,y,o,n,0,0,2*Math.PI),t.ctx.stroke()}),p=C(document,i=>{if(!e)return;t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height),e=!1;let l=i.x-s.x,a=i.y-s.y,o=Math.abs(l/2),n=Math.abs(a/2);if(w()){const x=Math.min(o,n);o=x,n=x}const h=s.x+(l>0?o:-o),y=s.y+(a>0?n:-n);c.focused.appendCircle({x:h,y,xRadius:o,yRadius:n,fillColor:"transparent",strokeColor:b("COLOR"),strokeWidth:b("STROKE")}),c.focused.requestRender(),c.focused.saveAsHistory()});return()=>{this.toolsArea.removeChild(t.canvas),t.destroy(),r(),d(),p()}}}R("ELIP",new U);class ${constructor(){f(this,"toolsArea");this.toolsArea=document.getElementById("toolsArea")}apply(){const t=T();this.toolsArea.appendChild(t.canvas),t.canvas.style.cursor="crosshair";let e=!1,s={x:0,y:0};const r=B(t.canvas,i=>{e=!0,s=i,t.ctx.strokeStyle=b("COLOR"),t.ctx.lineWidth=b("STROKE")}),d=g(document,i=>{if(!e)return;t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height);let l=i.x-s.x,a=i.y-s.y;if(w()){const n=Math.min(Math.abs(l),Math.abs(a));l=(l>0?1:-1)*n,a=(a>0?1:-1)*n*Math.sqrt(3)/2}let o=s.y;a>0&&(a=-a,o-=a),t.ctx.beginPath(),t.ctx.moveTo(s.x,o),t.ctx.lineTo(s.x+l,o),t.ctx.lineTo(s.x+l/2,o+a),t.ctx.closePath(),t.ctx.stroke()}),p=C(document,i=>{if(!e)return;t.ctx.clearRect(0,0,t.canvas.width,t.canvas.height),e=!1;let l=i.x-s.x,a=i.y-s.y;if(w()){const h=Math.min(Math.abs(l),Math.abs(a));l=(l>0?1:-1)*h,a=(a>0?1:-1)*h*Math.sqrt(3)/2}let o=s.x,n=s.y;l<0&&(o+=l,l=-l),a<0&&(n+=a,a=-a),c.focused.appendTriangle({x1:o,y1:n+a,x2:o+l,y2:n+a,x3:o+l/2,y3:n,fillColor:"transparent",strokeColor:b("COLOR"),strokeWidth:b("STROKE")}),c.focused.requestRender(),c.focused.saveAsHistory()});return()=>{this.toolsArea.removeChild(t.canvas),t.destroy(),r(),d(),p()}}}R("TRI",new $);
